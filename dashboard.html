<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>ZERIONX1 · Institutional Dashboard</title>
  
  <!-- Supabase JS SDK -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet">
  
  <!-- Font Awesome Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <style>
    /* ----- INSTITUTIONAL DASHBOARD THEME ----- */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Poppins', sans-serif;
    }

    :root {
      --obsidian: #03050A;
      --raisin: #0B0F16;
      --ebony: #11161F;
      --steel: #1E2632;
      --gold-24k: #C8AA6E;
      --gold-light: #E5D2AA;
      --gold-rich: #B49450;
      --platinum: #F2F4F8;
      --mist: #C0C8D2;
      --slate: #5D697A;
      --success: #00C851;
      --error: #ff4444;
      --warning: #ffbb33;
      --info: #33b5e5;
      --glass: rgba(17, 22, 31, 0.85);
      --glass-edge: 1px solid rgba(200, 170, 110, 0.15);
      --gradient-gold: linear-gradient(135deg, var(--gold-24k), var(--gold-rich));
      --shadow-heavy: 0 20px 40px -12px rgba(0, 0, 0, 0.8);
      --transition-ex: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
    }

    body {
      background-color: var(--obsidian);
      color: var(--platinum);
      min-height: 100vh;
      overflow-x: hidden;
      font-size: 14px;
      line-height: 1.5;
    }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 6px; height: 6px; }
    ::-webkit-scrollbar-track { background: var(--raisin); }
    ::-webkit-scrollbar-thumb { background: var(--gold-24k); border-radius: 20px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--gold-light); }

    /* Dashboard grid layout */
    .dashboard-container {
      display: grid;
      grid-template-columns: 260px 1fr;
      min-height: 100vh;
      transition: var(--transition-ex);
    }

    /* ----- SIDEBAR (LEFT NAV) ----- */
    .sidebar {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-right: var(--glass-edge);
      padding: 28px 16px;
      display: flex;
      flex-direction: column;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow-y: auto;
      transition: var(--transition-ex);
    }

    .sidebar.collapsed {
      margin-left: -260px;
    }

    .sidebar-logo {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 24px;
      font-weight: 700;
      color: white;
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 0 12px 28px 12px;
      border-bottom: 1px solid rgba(200, 170, 110, 0.2);
      margin-bottom: 24px;
    }

    .sidebar-logo i {
      color: var(--gold-24k);
      font-size: 28px;
    }

    .sidebar-logo span {
      color: var(--gold-24k);
    }

    .nav-menu {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 14px;
      padding: 12px 16px;
      border-radius: 16px;
      color: var(--mist);
      text-decoration: none;
      font-weight: 500;
      transition: var(--transition-ex);
      cursor: pointer;
    }

    .nav-item i {
      font-size: 20px;
      width: 24px;
      color: var(--slate);
      transition: var(--transition-ex);
    }

    .nav-item:hover {
      background: rgba(200, 170, 110, 0.08);
      color: var(--gold-light);
    }

    .nav-item:hover i {
      color: var(--gold-24k);
    }

    .nav-item.active {
      background: rgba(200, 170, 110, 0.12);
      color: var(--gold-24k);
      border-left: 3px solid var(--gold-24k);
    }

    .nav-item.active i {
      color: var(--gold-24k);
    }

    /* ----- MAIN CONTENT AREA ----- */
    .main-content {
      display: flex;
      flex-direction: column;
      min-width: 0; /* prevents flex overflow */
    }

    /* ----- TOP NAVIGATION BAR ----- */
    .top-nav {
      background: var(--glass);
      backdrop-filter: blur(20px);
      -webkit-backdrop-filter: blur(20px);
      border-bottom: var(--glass-edge);
      padding: 12px 28px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .left-area {
      display: flex;
      align-items: center;
      gap: 24px;
    }

    .menu-toggle {
      display: none;
      background: transparent;
      border: none;
      color: var(--gold-24k);
      font-size: 24px;
      cursor: pointer;
    }

    .market-status {
      display: flex;
      align-items: center;
      gap: 8px;
      background: rgba(0, 200, 81, 0.1);
      padding: 6px 16px;
      border-radius: 40px;
      border: 1px solid rgba(0, 200, 81, 0.3);
    }

    .status-indicator {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse-green 1.5s infinite;
    }

    @keyframes pulse-green {
      0% { box-shadow: 0 0 0 0 rgba(0, 200, 81, 0.7); }
      70% { box-shadow: 0 0 0 6px rgba(0, 200, 81, 0); }
      100% { box-shadow: 0 0 0 0 rgba(0, 200, 81, 0); }
    }

    .status-text {
      font-weight: 600;
      font-size: 13px;
      color: var(--success);
    }

    .right-area {
      display: flex;
      align-items: center;
      gap: 20px;
    }

    .notification-bell {
      position: relative;
      font-size: 22px;
      color: var(--mist);
      cursor: pointer;
    }

    .notification-bell::after {
      content: '';
      position: absolute;
      top: 2px;
      right: 2px;
      width: 8px;
      height: 8px;
      background: var(--gold-24k);
      border-radius: 50%;
    }

    .profile-dropdown {
      position: relative;
      display: inline-block;
    }

    .profile-btn {
      display: flex;
      align-items: center;
      gap: 10px;
      background: var(--steel);
      border: 1px solid rgba(200, 170, 110, 0.3);
      padding: 6px 12px 6px 8px;
      border-radius: 40px;
      cursor: pointer;
      transition: var(--transition-ex);
    }

    .profile-btn:hover {
      border-color: var(--gold-24k);
      background: rgba(200, 170, 110, 0.1);
    }

    .profile-btn img {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: var(--gold-24k);
    }

    .profile-btn i {
      color: var(--gold-24k);
      font-size: 14px;
    }

    .dropdown-menu {
      position: absolute;
      right: 0;
      top: 48px;
      background: var(--steel);
      border: var(--glass-edge);
      border-radius: 16px;
      width: 180px;
      box-shadow: var(--shadow-heavy);
      display: none;
      z-index: 1000;
    }

    .dropdown-menu.show {
      display: block;
    }

    .dropdown-item {
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 12px;
      color: var(--mist);
      text-decoration: none;
      transition: var(--transition-ex);
      cursor: pointer;
    }

    .dropdown-item:hover {
      background: rgba(200, 170, 110, 0.1);
      color: var(--gold-light);
    }

    .dropdown-item i {
      width: 20px;
      color: var(--gold-24k);
    }

    hr {
      border: none;
      border-top: 1px solid rgba(200, 170, 110, 0.2);
      margin: 8px 0;
    }

    /* ----- DASHBOARD CONTENT ----- */
    .dashboard-body {
      padding: 28px;
      overflow-y: auto;
    }

    /* KPI Cards grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 20px;
      margin-bottom: 28px;
    }

    .stat-card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: var(--glass-edge);
      border-radius: 24px;
      padding: 20px;
      transition: var(--transition-ex);
    }

    .stat-card:hover {
      transform: translateY(-4px);
      border-color: rgba(200, 170, 110, 0.4);
      box-shadow: var(--shadow-heavy);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      background: rgba(200, 170, 110, 0.12);
      border-radius: 18px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      color: var(--gold-24k);
    }

    .stat-value {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 28px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--mist);
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .positive { color: var(--success); }
    .negative { color: var(--error); }

    /* Chart + filters */
    .chart-card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: var(--glass-edge);
      border-radius: 28px;
      padding: 24px;
      margin-bottom: 28px;
    }

    .chart-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .chart-header h3 {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 20px;
      font-weight: 600;
    }

    .time-filters {
      display: flex;
      gap: 8px;
    }

    .time-btn {
      background: transparent;
      border: 1px solid rgba(200, 170, 110, 0.3);
      color: var(--mist);
      padding: 6px 14px;
      border-radius: 30px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      transition: var(--transition-ex);
    }

    .time-btn:hover,
    .time-btn.active {
      background: var(--gold-24k);
      color: var(--obsidian);
      border-color: var(--gold-24k);
    }

    canvas#portfolioChart {
      width: 100%;
      height: 260px;
      background: rgba(0, 0, 0, 0.2);
      border-radius: 20px;
    }

    /* Two column layout */
    .two-col-grid {
      display: grid;
      grid-template-columns: 1.5fr 1fr;
      gap: 24px;
      margin-bottom: 28px;
    }

    /* Active algorithms panel */
    .panel-card {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: var(--glass-edge);
      border-radius: 24px;
      padding: 20px;
    }

    .panel-title {
      font-family: 'Space Grotesk', sans-serif;
      font-size: 18px;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .algo-table {
      width: 100%;
      border-collapse: collapse;
    }

    .algo-table th {
      text-align: left;
      padding: 12px 8px;
      color: var(--mist);
      font-weight: 500;
      font-size: 12px;
      border-bottom: 1px solid rgba(200, 170, 110, 0.2);
    }

    .algo-table td {
      padding: 12px 8px;
      border-bottom: 1px solid rgba(200, 170, 110, 0.1);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 40px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-running {
      background: rgba(0, 200, 81, 0.15);
      color: var(--success);
    }

    .status-paused {
      background: rgba(255, 68, 68, 0.15);
      color: var(--error);
    }

    .toggle-switch {
      position: relative;
      display: inline-block;
      width: 44px;
      height: 22px;
      background: var(--steel);
      border-radius: 30px;
      border: 1px solid rgba(200, 170, 110, 0.3);
      cursor: pointer;
    }

    .toggle-switch::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 18px;
      background: var(--gold-24k);
      border-radius: 50%;
      top: 1px;
      left: 2px;
      transition: var(--transition-ex);
    }

    .toggle-switch.active {
      background: rgba(200, 170, 110, 0.3);
    }

    .toggle-switch.active::after {
      left: 23px;
    }

    /* Paper trading summary */
    .paper-summary {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .paper-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 0;
      border-bottom: 1px dashed rgba(200,170,110,0.2);
    }

    .paper-label {
      color: var(--mist);
    }

    .paper-value {
      font-family: 'Space Grotesk', sans-serif;
      font-weight: 600;
      font-size: 18px;
    }

    .paper-btn {
      background: transparent;
      border: 1px solid var(--gold-24k);
      color: var(--gold-24k);
      padding: 12px;
      border-radius: 30px;
      font-weight: 600;
      cursor: pointer;
      transition: var(--transition-ex);
      margin-top: 12px;
    }

    .paper-btn:hover {
      background: var(--gold-24k);
      color: var(--obsidian);
    }

    /* Recent trades table */
    .recent-trades {
      margin-bottom: 28px;
    }

    .trades-table {
      width: 100%;
      border-collapse: collapse;
    }

    .trades-table th {
      text-align: left;
      padding: 14px 8px;
      color: var(--mist);
      font-weight: 500;
      font-size: 12px;
    }

    .trades-table td {
      padding: 12px 8px;
      border-bottom: 1px solid rgba(200,170,110,0.1);
    }

    /* Market watchlist widget */
    .market-widget {
      background: var(--glass);
      backdrop-filter: blur(12px);
      border: var(--glass-edge);
      border-radius: 24px;
      padding: 20px;
    }

    .market-item {
      display: flex;
      justify-content: space-between;
      padding: 12px 0;
      border-bottom: 1px solid rgba(200,170,110,0.1);
    }

    .market-symbol {
      font-weight: 600;
    }

    .market-price {
      font-family: 'Space Grotesk', sans-serif;
    }

    /* System status */
    .status-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 16px;
      margin-top: 24px;
    }

    .status-item {
      background: rgba(0,0,0,0.3);
      border-radius: 16px;
      padding: 12px;
      text-align: center;
    }

    .status-item i {
      color: var(--success);
      margin-right: 6px;
    }

    /* Responsive */
    @media (max-width: 1200px) {
      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 992px) {
      .two-col-grid {
        grid-template-columns: 1fr;
      }
      .sidebar {
        position: fixed;
        z-index: 1000;
        margin-left: -260px;
      }
      .sidebar.show {
        margin-left: 0;
      }
      .menu-toggle {
        display: block;
      }
      .dashboard-container {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 576px) {
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .time-filters {
        margin-top: 12px;
      }
      .chart-header {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- SIDEBAR (Left Navigation) -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-logo">
        <i class="fas fa-chart-network"></i> ZERIONX<span>1</span>
      </div>
      <div class="nav-menu">
        <a href="#" class="nav-item active">
          <i class="fas fa-home"></i> <span>Dashboard</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-robot"></i> <span>Algorithms</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-plus-circle"></i> <span>Create Strategy</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-flask"></i> <span>Paper Trading</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-chart-line"></i> <span>Live Trading</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-history"></i> <span>Backtesting</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-chart-pie"></i> <span>Analytics / Reports</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-plug"></i> <span>Broker Connections</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-credit-card"></i> <span>Subscription / Billing</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-headset"></i> <span>Support</span>
        </a>
        <a href="#" class="nav-item">
          <i class="fas fa-cog"></i> <span>Settings</span>
        </a>
      </div>
    </aside>

    <!-- MAIN CONTENT -->
    <main class="main-content">
      <!-- TOP NAVIGATION -->
      <header class="top-nav">
        <div class="left-area">
          <button class="menu-toggle" id="menuToggle">
            <i class="fas fa-bars"></i>
          </button>
          <div class="market-status">
            <span class="status-indicator"></span>
            <span class="status-text">LIVE</span>
          </div>
        </div>
        <div class="right-area">
          <div class="notification-bell">
            <i class="far fa-bell"></i>
          </div>
          <div class="profile-dropdown" id="profileDropdown">
            <div class="profile-btn" id="profileBtn">
              <img src="https://ui-avatars.com/api/?name=Trader&background=C8AA6E&color=03050A&bold=true" alt="user">
              <span>Trader</span>
              <i class="fas fa-chevron-down"></i>
            </div>
            <div class="dropdown-menu" id="dropdownMenu">
              <div class="dropdown-item">
                <i class="fas fa-user"></i> Profile
              </div>
              <div class="dropdown-item">
                <i class="fas fa-cog"></i> Settings
              </div>
              <hr>
              <div class="dropdown-item" id="logoutBtn">
                <i class="fas fa-sign-out-alt"></i> Logout
              </div>
            </div>
          </div>
        </div>
      </header>

      <!-- DASHBOARD BODY -->
      <div class="dashboard-body">
        <!-- KPI Cards -->
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon"><i class="fas fa-wallet"></i></div>
            </div>
            <div class="stat-value" id="portfolioValue">$1,84,250</div>
            <div class="stat-label">Total Portfolio Value</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
            </div>
            <div class="stat-value positive" id="todayPnL">+$2,340</div>
            <div class="stat-label">Today’s Profit/Loss</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon"><i class="fas fa-robot"></i></div>
            </div>
            <div class="stat-value" id="activeAlgos">6</div>
            <div class="stat-label">Active Algorithms</div>
          </div>
          <div class="stat-card">
            <div class="stat-header">
              <div class="stat-icon"><i class="fas fa-percent"></i></div>
            </div>
            <div class="stat-value positive" id="winRate">74.5%</div>
            <div class="stat-label">Win Rate</div>
          </div>
        </div>

        <!-- Performance Chart -->
        <div class="chart-card">
          <div class="chart-header">
            <h3><i class="fas fa-chart-area" style="color:var(--gold-24k); margin-right:8px;"></i>Portfolio Performance</h3>
            <div class="time-filters">
              <button class="time-btn active">1D</button>
              <button class="time-btn">1W</button>
              <button class="time-btn">1M</button>
              <button class="time-btn">1Y</button>
            </div>
          </div>
          <canvas id="portfolioChart"></canvas>
        </div>

        <!-- Two column: Active Algorithms + Paper Trading -->
        <div class="two-col-grid">
          <!-- Active Algorithms Panel -->
          <div class="panel-card">
            <div class="panel-title">
              <i class="fas fa-microchip" style="color:var(--gold-24k);"></i> Active Algorithms
            </div>
            <table class="algo-table">
              <thead>
                <tr><th>Strategy</th><th>Market</th><th>Status</th><th>Profit</th><th>Risk</th><th></th></tr>
              </thead>
              <tbody>
                <tr><td>Momentum+</td><td>NIFTY</td><td><span class="status-badge status-running">Running</span></td><td class="positive">+12.4%</td><td>Mod</td><td><span class="toggle-switch active"></span></td></tr>
                <tr><td>MeanReversion</td><td>BTCUSDT</td><td><span class="status-badge status-running">Running</span></td><td class="positive">+8.2%</td><td>Low</td><td><span class="toggle-switch active"></span></td></tr>
                <tr><td>ArbitrageX</td><td>BANKNIFTY</td><td><span class="status-badge status-paused">Paused</span></td><td class="negative">-2.1%</td><td>High</td><td><span class="toggle-switch"></span></td></tr>
                <tr><td>TrendFollow</td><td>GOLD</td><td><span class="status-badge status-running">Running</span></td><td class="positive">+5.7%</td><td>Mod</td><td><span class="toggle-switch active"></span></td></tr>
              </tbody>
            </table>
          </div>

          <!-- Paper Trading Summary + Market Watch -->
          <div>
            <div class="panel-card" style="margin-bottom:24px;">
              <div class="panel-title">
                <i class="fas fa-flask" style="color:var(--gold-24k);"></i> Paper Trading Summary
              </div>
              <div class="paper-summary">
                <div class="paper-row"><span class="paper-label">Virtual Balance</span><span class="paper-value" id="paperBalance">$100,000</span></div>
                <div class="paper-row"><span class="paper-label">Today Trades</span><span class="paper-value" id="todayTrades">24</span></div>
                <div class="paper-row"><span class="paper-label">Paper PnL</span><span class="paper-value positive" id="paperPnL">+$1,890</span></div>
                <button class="paper-btn">Open Paper Trading</button>
              </div>
            </div>

            <!-- Market Watchlist -->
            <div class="market-widget">
              <div class="panel-title" style="margin-bottom:16px;">
                <i class="fas fa-eye" style="color:var(--gold-24k);"></i> Market Watch
              </div>
              <div id="marketList"></div>
            </div>
          </div>
        </div>

        <!-- Recent Trades Table -->
        <div class="panel-card recent-trades">
          <div class="panel-title">
            <i class="fas fa-history" style="color:var(--gold-24k);"></i> Recent Trades
          </div>
          <table class="trades-table">
            <thead>
              <tr><th>Time</th><th>Symbol</th><th>Side</th><th>Entry</th><th>Exit</th><th>PnL</th><th>Status</th></tr>
            </thead>
            <tbody id="recentTradesBody"></tbody>
          </table>
        </div>

        <!-- System Status Panel -->
        <div class="panel-card">
          <div class="panel-title">
            <i class="fas fa-server" style="color:var(--gold-24k);"></i> System Status
          </div>
          <div class="status-grid">
            <div class="status-item"><i class="fas fa-check-circle" style="color:var(--success);"></i> Server</div>
            <div class="status-item"><i class="fas fa-check-circle" style="color:var(--success);"></i> Algo Engine</div>
            <div class="status-item"><i class="fas fa-check-circle" style="color:var(--success);"></i> Broker Connection</div>
            <div class="status-item"><i class="fas fa-check-circle" style="color:var(--success);"></i> Data Feed</div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <script>
    (function() {
      // --------------------------------------------------------------
      // 1. SUPABASE SESSION PROTECTION
      // --------------------------------------------------------------
      const { createClient } = supabase;
      const SUPABASE_URL = 'https://dpmqjvaylnszykujmufv.supabase.co';
      const SUPABASE_ANON_KEY = 'sb_publishable_S2HHT0VP1Ru6Dk63ju7V-Q_FnNfX1sd';
      const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

      async function checkAuth() {
        const { data: { session }, error } = await supabaseClient.auth.getSession();
        if (!session) {
          window.location.href = 'login.html';
        }
      }
      checkAuth();

      // --------------------------------------------------------------
      // 2. UI INTERACTIONS (sidebar toggle, dropdown)
      // --------------------------------------------------------------
      const sidebar = document.getElementById('sidebar');
      const menuToggle = document.getElementById('menuToggle');
      if (menuToggle) {
        menuToggle.addEventListener('click', () => {
          sidebar.classList.toggle('show');
        });
      }

      // Profile dropdown
      const profileBtn = document.getElementById('profileBtn');
      const dropdownMenu = document.getElementById('dropdownMenu');
      if (profileBtn) {
        profileBtn.addEventListener('click', (e) => {
          e.stopPropagation();
          dropdownMenu.classList.toggle('show');
        });
      }
      document.addEventListener('click', () => {
        dropdownMenu.classList.remove('show');
      });

      // Logout
      document.getElementById('logoutBtn').addEventListener('click', async () => {
        await supabaseClient.auth.signOut();
        window.location.href = 'login.html';
      });

      // --------------------------------------------------------------
      // 3. FAKE LIVE DATA UPDATES (every 3 seconds)
      // --------------------------------------------------------------
      function randomChange(base, volatility) {
        return (base * (1 + (Math.random() * volatility * 2 - volatility))).toFixed(2);
      }

      function formatNumber(num) {
        return num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      }

      function updateStats() {
        // Portfolio value
        let portfolio = parseFloat(document.getElementById('portfolioValue').innerText.replace(/[$,]/g, ''));
        let newPort = portfolio * (1 + (Math.random() * 0.02 - 0.01));
        document.getElementById('portfolioValue').innerText = '$' + formatNumber(newPort.toFixed(0));

        // Today PnL
        let pnl = parseFloat(document.getElementById('todayPnL').innerText.replace(/[+,$]/g, ''));
        let newPnl = pnl * (1 + (Math.random() * 0.3 - 0.15));
        let sign = newPnl >= 0 ? '+' : '-';
        document.getElementById('todayPnL').innerText = sign + '$' + formatNumber(Math.abs(newPnl).toFixed(0));
        document.getElementById('todayPnL').className = newPnl >= 0 ? 'stat-value positive' : 'stat-value negative';

        // Active algorithms (random 4-9)
        let algoCount = Math.floor(Math.random() * 6) + 4;
        document.getElementById('activeAlgos').innerText = algoCount;

        // Win rate
        let win = (Math.random() * 20 + 65).toFixed(1);
        document.getElementById('winRate').innerText = win + '%';
        document.getElementById('winRate').className = win >= 50 ? 'stat-value positive' : 'stat-value negative';

        // Paper trading
        let paperBal = 100000 * (1 + (Math.random() * 0.02 - 0.01));
        document.getElementById('paperBalance').innerText = '$' + formatNumber(paperBal.toFixed(0));
        let paperPnL = (Math.random() * 2000 - 500).toFixed(0);
        let paperSign = paperPnL >= 0 ? '+' : '-';
        document.getElementById('paperPnL').innerText = paperSign + '$' + formatNumber(Math.abs(paperPnL));
        document.getElementById('paperPnL').className = paperPnL >= 0 ? 'paper-value positive' : 'paper-value negative';
        document.getElementById('todayTrades').innerText = Math.floor(Math.random() * 30 + 10);
      }

      // Update every 3 seconds
      setInterval(updateStats, 3000);

      // --------------------------------------------------------------
      // 4. MARKET WATCHLIST (dynamic)
      // --------------------------------------------------------------
      const marketData = [
        { symbol: 'NIFTY', price: 22450, change: 0.85 },
        { symbol: 'BANKNIFTY', price: 48750, change: -0.32 },
        { symbol: 'BTCUSDT', price: 68250, change: 2.14 },
        { symbol: 'ETHUSDT', price: 3450, change: 1.23 },
        { symbol: 'GOLD', price: 2345, change: -0.45 }
      ];

      function renderMarket() {
        const container = document.getElementById('marketList');
        container.innerHTML = '';
        marketData.forEach(m => {
          const changeClass = m.change >= 0 ? 'positive' : 'negative';
          const sign = m.change >= 0 ? '+' : '';
          container.innerHTML += `
            <div class="market-item">
              <span class="market-symbol">${m.symbol}</span>
              <span class="market-price">$${m.price.toLocaleString()} <span class="${changeClass}">(${sign}${m.change}%)</span></span>
            </div>
          `;
        });
      }
      renderMarket();

      // Update market prices randomly
      setInterval(() => {
        marketData.forEach(m => {
          m.price = m.price * (1 + (Math.random() * 0.02 - 0.01));
          m.change = (Math.random() * 6 - 3);
        });
        renderMarket();
      }, 3000);

      // --------------------------------------------------------------
      // 5. RECENT TRADES TABLE (dummy data)
      // --------------------------------------------------------------
      const trades = [
        { time: '09:45', symbol: 'NIFTY', side: 'BUY', entry: '22450', exit: '22520', pnl: '+70', status: 'WIN' },
        { time: '10:12', symbol: 'BTCUSDT', side: 'SELL', entry: '68500', exit: '67800', pnl: '+700', status: 'WIN' },
        { time: '11:30', symbol: 'GOLD', side: 'BUY', entry: '2345', exit: '2332', pnl: '-13', status: 'LOSS' },
        { time: '12:45', symbol: 'BANKNIFTY', side: 'BUY', entry: '48750', exit: '48890', pnl: '+140', status: 'WIN' },
        { time: '14:00', symbol: 'ETHUSDT', side: 'SELL', entry: '3460', exit: '3452', pnl: '-8', status: 'LOSS' }
      ];

      function renderTrades() {
        const tbody = document.getElementById('recentTradesBody');
        tbody.innerHTML = '';
        trades.forEach(t => {
          tbody.innerHTML += `
            <tr>
              <td>${t.time}</td>
              <td>${t.symbol}</td>
              <td style="color:${t.side === 'BUY' ? 'var(--success)' : 'var(--error)'};">${t.side}</td>
              <td>$${t.entry}</td>
              <td>$${t.exit}</td>
              <td class="${t.pnl.startsWith('+') ? 'positive' : 'negative'}">${t.pnl}</td>
              <td><span class="status-badge ${t.status === 'WIN' ? 'status-running' : 'status-paused'}">${t.status}</span></td>
            </tr>
          `;
        });
      }
      renderTrades();

      // --------------------------------------------------------------
      // 6. DUMMY CHART (canvas)
      // --------------------------------------------------------------
      const canvas = document.getElementById('portfolioChart');
      if (canvas) {
        const ctx = canvas.getContext('2d');
        const width = canvas.width = canvas.offsetWidth;
        const height = canvas.height = 260;

        function drawChart() {
          ctx.clearRect(0, 0, width, height);
          ctx.beginPath();
          ctx.strokeStyle = '#C8AA6E';
          ctx.lineWidth = 3;
          ctx.shadowColor = '#C8AA6E';
          ctx.shadowBlur = 10;

          const points = 40;
          const dx = width / points;
          let x = 0;
          let y = height / 2;

          ctx.moveTo(x, y);
          for (let i = 1; i <= points; i++) {
            y = height / 2 + Math.sin(i * 0.5) * 40 + Math.cos(i * 0.2) * 30;
            ctx.lineTo(i * dx, y);
          }
          ctx.stroke();

          // Fill under the curve
          ctx.lineTo(width, height);
          ctx.lineTo(0, height);
          ctx.closePath();
          ctx.globalAlpha = 0.1;
          ctx.fillStyle = '#C8AA6E';
          ctx.fill();
          ctx.globalAlpha = 1;
          ctx.shadowBlur = 0;
        }

        drawChart();
        window.addEventListener('resize', () => {
          canvas.width = canvas.offsetWidth;
          drawChart();
        });
      }
    })();
  </script>
</body>
</html>
